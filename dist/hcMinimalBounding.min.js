var hcMinimalBounding;(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{MinimalBounding:()=>n}),function e(t,n,r){function o(i,s){if(!n[i]){if(!t[i]){if(a)return a(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[i]={exports:{}};t[i][0].call(l.exports,(function(e){return o(t[i][1][e]||e)}),l,l.exports,e,t,n,r)}return n[i].exports}for(var a=void 0,i=0;i<r.length;i++)o(r[i]);return o}({1:[function(e,t,n){var r,o,a=t.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function c(e){if(r===setTimeout)return setTimeout(e,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(e){r=i}try{o="function"==typeof clearTimeout?clearTimeout:s}catch(e){o=s}}();var l,u=[],d=!1,f=-1;function h(){d&&l&&(d=!1,l.length?u=l.concat(u):f=-1,u.length&&p())}function p(){if(!d){var e=c(h);d=!0;for(var t=u.length;t;){for(l=u,u=[];++f<t;)l&&l[f].run();f=-1,t=u.length}l=null,d=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===s||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{o(e)}catch(t){try{return o.call(null,e)}catch(t){return o.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function v(){}a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new m(e,t)),1!==u.length||d||c(p)},m.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=v,a.addListener=v,a.once=v,a.off=v,a.removeListener=v,a.removeAllListeners=v,a.emit=v,a.prependListener=v,a.prependOnceListener=v,a.listeners=function(e){return[]},a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},{}],2:[function(e,t,n){var r=e("gl-vec3/normalize"),o=e("gl-vec3/subtract"),a=e("gl-vec3/cross"),i=[0,0,0];t.exports=function(e,t,n,s){return o(e,t,n),o(i,n,s),a(e,e,i),r(e,e)}},{"gl-vec3/cross":5,"gl-vec3/normalize":9,"gl-vec3/subtract":14}],3:[function(e,t,n){t.exports=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}},{}],4:[function(e,t,n){t.exports=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}},{}],5:[function(e,t,n){t.exports=function(e,t,n){var r=t[0],o=t[1],a=t[2],i=n[0],s=n[1],c=n[2];return e[0]=o*c-a*s,e[1]=a*i-r*c,e[2]=r*s-o*i,e}},{}],6:[function(e,t,n){t.exports=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],o=t[2]-e[2];return Math.sqrt(n*n+r*r+o*o)}},{}],7:[function(e,t,n){t.exports=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}},{}],8:[function(e,t,n){t.exports=function(e){var t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)}},{}],9:[function(e,t,n){t.exports=function(e,t){var n=t[0],r=t[1],o=t[2],a=n*n+r*r+o*o;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e}},{}],10:[function(e,t,n){t.exports=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}},{}],11:[function(e,t,n){t.exports=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}},{}],12:[function(e,t,n){t.exports=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],o=t[2]-e[2];return n*n+r*r+o*o}},{}],13:[function(e,t,n){t.exports=function(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}},{}],14:[function(e,t,n){t.exports=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}},{}],15:[function(e,t,n){var r=e("./squared");t.exports=function(e,t,n){return Math.sqrt(r(e,t,n))}},{"./squared":16}],16:[function(e,t,n){var r=e("gl-vec3/subtract"),o=e("gl-vec3/cross"),a=e("gl-vec3/squaredLength"),i=[],s=[],c=[];t.exports=function(e,t,n){r(i,n,t),r(s,e,t);var l=a(o(c,s,i)),u=a(i);if(0===u)throw Error("a and b are the same point");return l/u}},{"gl-vec3/cross":5,"gl-vec3/squaredLength":13,"gl-vec3/subtract":14}],17:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.VISIBLE=n.NON_CONVEX=n.DELETED=void 0;var r=h(e("gl-vec3/dot")),o=h(e("gl-vec3/add")),a=h(e("gl-vec3/subtract")),i=h(e("gl-vec3/cross")),s=h(e("gl-vec3/copy")),c=h(e("gl-vec3/length")),l=h(e("gl-vec3/scale")),u=h(e("gl-vec3/scaleAndAdd")),d=h(e("gl-vec3/normalize")),f=h(e("./HalfEdge"));function h(e){return e&&e.__esModule?e:{default:e}}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var m=e("debug")("face");n.VISIBLE=0,n.NON_CONVEX=1,n.DELETED=2;var v=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.normal=[],this.centroid=[],this.offset=0,this.outside=null,this.mark=0,this.edge=null,this.nVertices=0}var t,n,h;return t=e,h=[{key:"createTriangle",value:function(t,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=new e,i=new f.default(t,a),s=new f.default(n,a),c=new f.default(r,a);return i.next=c.prev=s,s.next=i.prev=c,c.next=s.prev=i,a.edge=i,a.computeNormalAndCentroid(o),m.enabled&&m("face created %j",a.collectIndices()),a}}],(n=[{key:"getEdge",value:function(e){if("number"!=typeof e)throw Error("requires a number");for(var t=this.edge;e>0;)t=t.next,e-=1;for(;e<0;)t=t.prev,e+=1;return t}},{key:"computeNormal",value:function(){var e=this.edge,t=e.next,n=t.next,r=(0,a.default)([],t.head().point,e.head().point),u=[],d=[];for(this.nVertices=2,this.normal=[0,0,0];n!==e;)(0,s.default)(d,r),(0,a.default)(r,n.head().point,e.head().point),(0,o.default)(this.normal,this.normal,(0,i.default)(u,d,r)),n=n.next,this.nVertices+=1;this.area=(0,c.default)(this.normal),this.normal=(0,l.default)(this.normal,this.normal,1/this.area)}},{key:"computeNormalMinArea",value:function(e){if(this.computeNormal(),this.area<e){var t,n=0,o=this.edge;do{var i=o.lengthSquared();i>n&&(t=o,n=i),o=o.next}while(o!==this.edge);var s=t.tail().point,c=t.head().point,f=(0,a.default)([],c,s),h=Math.sqrt(n);(0,l.default)(f,f,1/h);var p=(0,r.default)(this.normal,f);(0,u.default)(this.normal,this.normal,f,-p),(0,d.default)(this.normal,this.normal)}}},{key:"computeCentroid",value:function(){this.centroid=[0,0,0];var e=this.edge;do{(0,o.default)(this.centroid,this.centroid,e.head().point),e=e.next}while(e!==this.edge);(0,l.default)(this.centroid,this.centroid,1/this.nVertices)}},{key:"computeNormalAndCentroid",value:function(e){void 0!==e?this.computeNormalMinArea(e):this.computeNormal(),this.computeCentroid(),this.offset=(0,r.default)(this.normal,this.centroid)}},{key:"distanceToPlane",value:function(e){return(0,r.default)(this.normal,e)-this.offset}},{key:"connectHalfEdges",value:function(e,t){var n;if(e.opposite.face===t.opposite.face){var r,o=t.opposite.face;e===this.edge&&(this.edge=t),3===o.nVertices?(r=t.opposite.prev.opposite,o.mark=2,n=o):(r=t.opposite.next,o.edge===r.prev&&(o.edge=r),r.prev=r.prev.prev,r.prev.next=r),t.prev=e.prev,t.prev.next=t,t.setOpposite(r),o.computeNormalAndCentroid()}else e.next=t,t.prev=e;return n}},{key:"mergeAdjacentFaces",value:function(e,t){var n=e.opposite,r=n.face;t.push(r),r.mark=2;for(var o,a,i=e.prev,s=e.next,c=n.prev,l=n.next;i.opposite.face===r;)i=i.prev,l=l.next;for(;s.opposite.face===r;)s=s.next,c=c.prev;for(o=l;o!==c.next;o=o.next)o.face=this;return this.edge=s,(a=this.connectHalfEdges(c,s))&&t.push(a),(a=this.connectHalfEdges(i,l))&&t.push(a),this.computeNormalAndCentroid(),t}},{key:"collectIndices",value:function(){var e=[],t=this.edge;do{e.push(t.head().index),t=t.next}while(t!==this.edge);return e}}])&&p(t.prototype,n),h&&p(t,h),Object.defineProperty(t,"prototype",{writable:!1}),e}();n.default=v},{"./HalfEdge":18,debug:23,"gl-vec3/add":3,"gl-vec3/copy":4,"gl-vec3/cross":5,"gl-vec3/dot":7,"gl-vec3/length":8,"gl-vec3/normalize":9,"gl-vec3/scale":10,"gl-vec3/scaleAndAdd":11,"gl-vec3/subtract":14}],18:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=a(e("gl-vec3/distance")),o=a(e("gl-vec3/squaredDistance"));function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=e("debug")("halfedge"),c=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.vertex=t,this.face=n,this.next=null,this.prev=null,this.opposite=null}var t,n;return t=e,(n=[{key:"head",value:function(){return this.vertex}},{key:"tail",value:function(){return this.prev?this.prev.vertex:null}},{key:"length",value:function(){return this.tail()?(0,r.default)(this.tail().point,this.head().point):-1}},{key:"lengthSquared",value:function(){return this.tail()?(0,o.default)(this.tail().point,this.head().point):-1}},{key:"setOpposite",value:function(e){var t=this;s.enabled&&s("opposite ".concat(t.tail().index," <--\x3e ").concat(t.head().index," between ").concat(t.face.collectIndices(),", ").concat(e.face.collectIndices())),this.opposite=e,e.opposite=this}}])&&i(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();n.default=c},{debug:23,"gl-vec3/distance":6,"gl-vec3/squaredDistance":12}],19:[function(e,t,n){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=d(e("point-line-distance")),a=d(e("get-plane-normal")),i=d(e("gl-vec3/dot")),s=d(e("./VertexList")),c=d(e("./Vertex")),l=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!=typeof e)return{default:e};var n=u(t);if(n&&n.has(e))return n.get(e);var o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var s=a?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(o,i,s):o[i]=e[i]}return o.default=e,n&&n.set(e,o),o}(e("./Face"));function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(u=function(e){return e?n:t})(e)}function d(e){return e&&e.__esModule?e:{default:e}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var p=e("debug")("quickhull"),m=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!Array.isArray(t))throw TypeError("input is not a valid array");if(t.length<4)throw Error("cannot build a simplex out of <4 points");this.tolerance=-1,this.nFaces=0,this.nPoints=t.length,this.faces=[],this.newFaces=[],this.claimed=new s.default,this.unclaimed=new s.default,this.vertices=[];for(var n=0;n<t.length;n+=1)this.vertices.push(new c.default(t[n],n));this.discardedFaces=[],this.vertexPointIndices=[]}var t,n;return window.QuickHull=e,t=e,(n=[{key:"addVertexToFace",value:function(e,t){e.face=t,t.outside?this.claimed.insertBefore(t.outside,e):this.claimed.add(e),t.outside=e}},{key:"removeVertexFromFace",value:function(e,t){e===t.outside&&(e.next&&e.next.face===t?t.outside=e.next:t.outside=null),this.claimed.remove(e)}},{key:"removeAllVerticesFromFace",value:function(e){if(e.outside){for(var t=e.outside;t.next&&t.next.face===e;)t=t.next;return this.claimed.removeChain(e.outside,t),t.next=null,e.outside}}},{key:"deleteFaceVertices",value:function(e,t){var n=this.removeAllVerticesFromFace(e);if(n)if(t)for(var r,o=n;o;o=r)r=o.next,t.distanceToPlane(o.point)>this.tolerance?this.addVertexToFace(o,t):this.unclaimed.add(o);else this.unclaimed.addAll(n)}},{key:"resolveUnclaimedPoints",value:function(e){for(var t=this.unclaimed.first(),n=t;n;n=t){t=n.next;for(var r=this.tolerance,o=void 0,a=0;a<e.length;a+=1){var i=e[a];if(i.mark===l.VISIBLE){var s=i.distanceToPlane(n.point);if(s>r&&(r=s,o=i),r>1e3*this.tolerance)break}}o&&this.addVertexToFace(n,o)}}},{key:"computeExtremes",value:function(){var e,t,n=[],r=[],o=[],a=[];for(e=0;e<3;e+=1)o[e]=a[e]=this.vertices[0];for(e=0;e<3;e+=1)n[e]=r[e]=this.vertices[0].point[e];for(e=1;e<this.vertices.length;e+=1){var i=this.vertices[e],s=i.point;for(t=0;t<3;t+=1)s[t]<n[t]&&(n[t]=s[t],o[t]=i);for(t=0;t<3;t+=1)s[t]>r[t]&&(r[t]=s[t],a[t]=i)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(n[0]),Math.abs(r[0]))+Math.max(Math.abs(n[1]),Math.abs(r[1]))+Math.max(Math.abs(n[2]),Math.abs(r[2]))),p.enabled&&p("tolerance %d",this.tolerance),[o,a]}},{key:"createInitialSimplex",value:function(){var e,t,n=this.vertices,r=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){s=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(s)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(this.computeExtremes(),2),s=r[0],c=r[1],u=0,d=0;for(e=0;e<3;e+=1){var h=c[e].point[e]-s[e].point[e];h>u&&(u=h,d=e)}var p,m,v=s[d],g=c[d];for(u=0,e=0;e<this.vertices.length;e+=1){var y=this.vertices[e];if(y!==v&&y!==g){var x=(0,o.default)(y.point,v.point,g.point);x>u&&(u=x,p=y)}}var C=(0,a.default)([],v.point,g.point,p.point),w=(0,i.default)(v.point,C);for(u=-1,e=0;e<this.vertices.length;e+=1){var b=this.vertices[e];if(b!==v&&b!==g&&b!==p){var F=Math.abs((0,i.default)(C,b.point)-w);F>u&&(u=F,m=b)}}var M=[];if((0,i.default)(m.point,C)-w<0)for(M.push(l.default.createTriangle(v,g,p),l.default.createTriangle(m,g,v),l.default.createTriangle(m,p,g),l.default.createTriangle(m,v,p)),e=0;e<3;e+=1){var k=(e+1)%3;M[e+1].getEdge(2).setOpposite(M[0].getEdge(k)),M[e+1].getEdge(1).setOpposite(M[k+1].getEdge(0))}else for(M.push(l.default.createTriangle(v,p,g),l.default.createTriangle(m,v,g),l.default.createTriangle(m,g,p),l.default.createTriangle(m,p,v)),e=0;e<3;e+=1){var E=(e+1)%3;M[e+1].getEdge(2).setOpposite(M[0].getEdge((3-e)%3)),M[e+1].getEdge(0).setOpposite(M[E+1].getEdge(1))}for(e=0;e<4;e+=1)this.faces.push(M[e]);for(e=0;e<n.length;e+=1){var N=n[e];if(N!==v&&N!==g&&N!==p&&N!==m){u=this.tolerance;var A=void 0;for(t=0;t<4;t+=1){var O=M[t].distanceToPlane(N.point);O>u&&(u=O,A=M[t])}A&&this.addVertexToFace(N,A)}}}},{key:"reindexFaceAndVertices",value:function(){for(var e=[],t=0;t<this.faces.length;t+=1){var n=this.faces[t];n.mark===l.VISIBLE&&e.push(n)}this.faces=e}},{key:"collectFaces",value:function(e){for(var t=[],n=0;n<this.faces.length;n+=1){if(this.faces[n].mark!==l.VISIBLE)throw Error("attempt to include a destroyed face in the hull");var r=this.faces[n].collectIndices();if(e)t.push(r);else for(var o=0;o<r.length-2;o+=1)t.push([r[0],r[o+1],r[o+2]])}return t}},{key:"nextVertexToAdd",value:function(){if(!this.claimed.isEmpty()){var e,t,n=0,r=this.claimed.first().face;for(t=r.outside;t&&t.face===r;t=t.next){var o=r.distanceToPlane(t.point);o>n&&(n=o,e=t)}return e}}},{key:"computeHorizon",value:function(e,t,n,r){var o;this.deleteFaceVertices(n),n.mark=l.DELETED,o=t?t.next:t=n.getEdge(0);do{var a=o.opposite,i=a.face;i.mark===l.VISIBLE&&(i.distanceToPlane(e)>this.tolerance?this.computeHorizon(e,a,i,r):r.push(o)),o=o.next}while(o!==t)}},{key:"addAdjoiningFace",value:function(e,t){var n=l.default.createTriangle(e,t.tail(),t.head());return this.faces.push(n),n.getEdge(-1).setOpposite(t.opposite),n.getEdge(0)}},{key:"addNewFaces",value:function(e,t){var n,r;this.newFaces=[];for(var o=0;o<t.length;o+=1){var a=t[o],i=this.addAdjoiningFace(e,a);n?i.next.setOpposite(r):n=i,this.newFaces.push(i.face),r=i}n.next.setOpposite(r)}},{key:"oppositeFaceDistance",value:function(e){return e.face.distanceToPlane(e.opposite.face.centroid)}},{key:"doAdjacentMerge",value:function(e,t){var n=e.edge,r=!0,o=0;do{if(o>=e.nVertices)throw Error("merge recursion limit exceeded");var a=n.opposite.face,i=!1;if(2===t?(this.oppositeFaceDistance(n)>-this.tolerance||this.oppositeFaceDistance(n.opposite)>-this.tolerance)&&(i=!0):e.area>a.area?this.oppositeFaceDistance(n)>-this.tolerance?i=!0:this.oppositeFaceDistance(n.opposite)>-this.tolerance&&(r=!1):this.oppositeFaceDistance(n.opposite)>-this.tolerance?i=!0:this.oppositeFaceDistance(n)>-this.tolerance&&(r=!1),i){p("face merge");for(var s=e.mergeAdjacentFaces(n,[]),c=0;c<s.length;c+=1)this.deleteFaceVertices(s[c],e);return!0}n=n.next,o+=1}while(n!==e.edge);return r||(e.mark=l.NON_CONVEX),!1}},{key:"addVertexToHull",value:function(e){var t=[];this.unclaimed.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),p.enabled&&p("horizon %j",t.map((function(e){return e.head().index}))),this.addNewFaces(e,t),p("first merge");for(var n=0;n<this.newFaces.length;n+=1){var r=this.newFaces[n];if(r.mark===l.VISIBLE)for(;this.doAdjacentMerge(r,1););}p("second merge");for(var o=0;o<this.newFaces.length;o+=1){var a=this.newFaces[o];if(a.mark===l.NON_CONVEX)for(a.mark=l.VISIBLE;this.doAdjacentMerge(a,2););}p("reassigning points to newFaces"),this.resolveUnclaimedPoints(this.newFaces)}},{key:"build",value:function(){var e,t=0;for(this.createInitialSimplex();e=this.nextVertexToAdd();)p("== iteration %j ==",t+=1),p("next vertex to add = %d %j",e.index,e.point),this.addVertexToHull(e),p("end");this.reindexFaceAndVertices()}}])&&h(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();n.default=m},{"./Face":17,"./Vertex":20,"./VertexList":21,debug:23,"get-plane-normal":2,"gl-vec3/dot":7,"point-line-distance":15}],20:[function(e,t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var a=o((function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.point=t,this.index=n,this.next=null,this.prev=null,this.face=null}));n.default=a},{}],21:[function(e,t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null}var t,n;return t=e,(n=[{key:"clear",value:function(){this.head=this.tail=null}},{key:"insertBefore",value:function(e,t){t.prev=e.prev,t.next=e,t.prev?t.prev.next=t:this.head=t,e.prev=t}},{key:"insertAfter",value:function(e,t){t.prev=e,t.next=e.next,t.next?t.next.prev=t:this.tail=t,e.next=t}},{key:"add",value:function(e){this.head?this.tail.next=e:this.head=e,e.prev=this.tail,e.next=null,this.tail=e}},{key:"addAll",value:function(e){for(this.head?this.tail.next=e:this.head=e,e.prev=this.tail;e.next;)e=e.next;this.tail=e}},{key:"remove",value:function(e){e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev}},{key:"removeChain",value:function(e,t){e.prev?e.prev.next=t.next:this.head=t.next,t.next?t.next.prev=e.prev:this.tail=e.prev}},{key:"first",value:function(){return this.head}},{key:"isEmpty",value:function(){return!this.head}}])&&r(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();n.default=o},{}],22:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new r.default(e);return n.build(),n.collectFaces(t.skipTriangulation)},n.isPointInsideHull=function(e,t,n){for(var r=0;r<n.length;r++){var a=n[r],i=t[a[0]],s=t[a[1]],c=t[a[2]],l=(0,o.default)([],i,s,c),u=[e[0]-i[0],e[1]-i[1],e[2]-i[2]];if(l[0]*u[0]+l[1]*u[1]+l[2]*u[2]>0)return!1}return!0};var r=a(e("./QuickHull")),o=a(e("get-plane-normal"));function a(e){return e&&e.__esModule?e:{default:e}}},{"./QuickHull":19,"get-plane-normal":2}],23:[function(e,t,n){(function(r){(function(){n.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;e.splice(1,0,n,"color: inherit");let r=0,o=0;e[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(r++,"%c"===e&&(o=r))})),e.splice(o,0,n)},n.save=function(e){try{e?n.storage.setItem("debug",e):n.storage.removeItem("debug")}catch(e){}},n.load=function(){let e;try{e=n.storage.getItem("debug")}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG),e},n.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},n.storage=function(){try{return localStorage}catch(e){}}(),n.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),n.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],n.log=console.debug||console.log||(()=>{}),t.exports=e("./common")(n);const{formatters:o}=t.exports;o.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this)}).call(this,e("_process"))},{"./common":24,_process:1}],24:[function(e,t,n){t.exports=function(t){function n(e){let t,o,a,i=null;function s(...e){if(!s.enabled)return;const r=s,o=Number(new Date),a=o-(t||o);r.diff=a,r.prev=t,r.curr=o,t=o,e[0]=n.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let i=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((t,o)=>{if("%%"===t)return"%";i++;const a=n.formatters[o];if("function"==typeof a){const n=e[i];t=a.call(r,n),e.splice(i,1),i--}return t})),n.formatArgs.call(r,e),(r.log||n.log).apply(r,e)}return s.namespace=e,s.useColors=n.useColors(),s.color=n.selectColor(e),s.extend=r,s.destroy=n.destroy,Object.defineProperty(s,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==i?i:(o!==n.namespaces&&(o=n.namespaces,a=n.enabled(e)),a),set:e=>{i=e}}),"function"==typeof n.init&&n.init(s),s}function r(e,t){const r=n(this.namespace+(void 0===t?":":t)+e);return r.log=this.log,r}function o(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return n.debug=n,n.default=n,n.coerce=function(e){return e instanceof Error?e.stack||e.message:e},n.disable=function(){const e=[...n.names.map(o),...n.skips.map(o).map((e=>"-"+e))].join(",");return n.enable(""),e},n.enable=function(e){let t;n.save(e),n.namespaces=e,n.names=[],n.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),o=r.length;for(t=0;t<o;t++)r[t]&&("-"===(e=r[t].replace(/\*/g,".*?"))[0]?n.skips.push(new RegExp("^"+e.slice(1)+"$")):n.names.push(new RegExp("^"+e+"$")))},n.enabled=function(e){if("*"===e[e.length-1])return!0;let t,r;for(t=0,r=n.skips.length;t<r;t++)if(n.skips[t].test(e))return!1;for(t=0,r=n.names.length;t<r;t++)if(n.names[t].test(e))return!0;return!1},n.humanize=e("ms"),n.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(t).forEach((e=>{n[e]=t[e]})),n.names=[],n.skips=[],n.formatters={},n.selectColor=function(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return n.colors[Math.abs(t)%n.colors.length]},n.enable(n.load()),n}},{ms:25}],25:[function(e,t,n){var r=1e3,o=60*r,a=60*o,i=24*a;function s(e,t,n,r){var o=t>=1.5*n;return Math.round(e/n)+" "+r+(o?"s":"")}t.exports=function(e,t){t=t||{};var n,c,l=typeof e;if("string"===l&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*n;case"weeks":case"week":case"w":return 6048e5*n;case"days":case"day":case"d":return n*i;case"hours":case"hour":case"hrs":case"hr":case"h":return n*a;case"minutes":case"minute":case"mins":case"min":case"m":return n*o;case"seconds":case"second":case"secs":case"sec":case"s":return n*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}(e);if("number"===l&&isFinite(e))return t.long?(n=e,(c=Math.abs(n))>=i?s(n,c,i,"day"):c>=a?s(n,c,a,"hour"):c>=o?s(n,c,o,"minute"):c>=r?s(n,c,r,"second"):n+" ms"):function(e){var t=Math.abs(e);return t>=i?Math.round(e/i)+"d":t>=a?Math.round(e/a)+"h":t>=o?Math.round(e/o)+"m":t>=r?Math.round(e/r)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},{}]},{},[22]);class n{static async calculateMinimalBounding(e,t,r=1e4,o=.9,a=1){let i,s=await n._getMeshPoints(e,t),c={volume:Number.MAX_VALUE,angle:0,axis:new Communicator.Point3(1,0,0),min:new Communicator.Point3(0,0,0),max:new Communicator.Point3(0,0,0)},l=Number.MAX_VALUE,u=await e.model.getNodesBounding([t]);for(let d=0;d<4;d++){let f=360/a;0==d?i=new Communicator.Point3(0,0,1):1==d?i=new Communicator.Point3(0,1,0):2==d?i=new Communicator.Point3(1,0,0):f=r;for(let r=0;r<f;r++){let f;d>2?(i=new Communicator.Point3(Math.random(),Math.random(),Math.random()),i.normalize(),f=360*Math.random()):f=r*a;let h=await n._rotateNode(e,t,i,f,u.center(),!1),p=new Communicator.Point3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),m=new Communicator.Point3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),v=e.model.getNodeNetMatrix(e.model.getNodeParent(t)),g=[];Communicator.Matrix.multiply(h,v).transformArray(s,g);for(let e=0;e<s.length;e++){let t=g[e];t.x<p.x&&(p.x=t.x),t.y<p.y&&(p.y=t.y),t.z<p.z&&(p.z=t.z),t.x>m.x&&(m.x=t.x),t.y>m.y&&(m.y=t.y),t.z>m.z&&(m.z=t.z)}let y=(m.x-p.x)*(m.y-p.y)*(m.z-p.z);if(y<c.volume){if(y/l>o)continue;d<3&&(l=y),c.volume=y,c.angle=f,c.axis=i,c.min=p,c.max=m}}}let d=await n._createBoundingMesh(e,c.min,c.max),f=new Communicator.MeshInstanceData(d),h=e.model.createNode(e.model.getRootNode(),"Minimal Bounding for "+t),p=await e.model.createMeshInstance(f,h);return await n._rotateNode(e,p,c.axis,-c.angle,u.center(),!0),{nodeid:h,volume:c.volume,min:c.min,max:c.max}}static async showConvexHull(e,t){let r=[];var o=e.model.getNodeNetMatrix(t),a=Communicator.Matrix.inverse(o);await n._getMeshPointsRecursive(e,t,r,a,!0);let i=new QuickHull(r);i.build();let s=i.collectFaces();var c=new Communicator.MeshData;c.setFaceWinding(Communicator.FaceWinding.None);let l=[];for(let e=0;e<s.length;e++){let t=s[e];for(let e=0;e<3;e++){let n=t[e];l.push(r[n][0],r[n][1],r[n][2])}}c.addFaces(l);let u=await e.model.createMesh(c),d=new Communicator.MeshInstanceData(u);var f=e.model.createNode(e.model.getRootNode(),"Convex Hull for "+t);return await e.model.createMeshInstance(d,f),f}static async showBoundingMesh(e,t){let r=e.model,o=await r.getNodesBounding([t],{tightBounding:!0}),a=await n._createBoundingMesh(e,o.min,o.max),i=new Communicator.MeshInstanceData(a),s=e.model.createNode(e.model.getRootNode(),"Bounding for "+t),c=await e.model.createMeshInstance(i,s);return e.model.setNodesLineColor([c],new Communicator.Color(0,0,255)),s}static async _getMeshPointsRecursive(e,t,r,o,a=!1){let i=await e.model.getNodeChildren(t);try{if(0==i.length&&await e.model.getNodeMeshData(t)){let n;if(a)n=e.model.getNodeNetMatrix(t);else{let r=e.model.getNodeNetMatrix(t);n=Communicator.Matrix.multiply(r,o)}let i=await e.model.getNodeMeshData(t);for(let e=0;e<i.faces.elementCount;e++){let t=i.faces.element(e),o=t.iterate();for(let e=0;e<t.vertexCount;e+=3)for(let e=0;e<3;e++){let e=o.next(),t=new Communicator.Point3(e.position[0],e.position[1],e.position[2]),a=n.transform(t);r.push([a.x,a.y,a.z])}}}}catch(e){}for(let t=0;t<i.length;t++)await n._getMeshPointsRecursive(e,i[t],r,o,a)}static async _getMeshPoints(e,t){let r=[];var o=e.model.getNodeNetMatrix(t),a=Communicator.Matrix.inverse(o);await n._getMeshPointsRecursive(e,t,r,a);let i=[],s=new QuickHull(r);s.build();let c=s.collectFaces(),l=[];for(let e=0;e<c.length;e++){let t=c[e];for(let e=0;e<3;e++){let n=t[e];if(null==l[n]){l[n]=1;let e=new Communicator.Point3(r[n][0],r[n][1],r[n][2]);i.push(e)}}}return i}static async _rotateNode(e,t,r,o,a,i){let s=a;var c=e.model.getNodeNetMatrix(t),l=Communicator.Matrix.inverse(c),u=l.transform(s),d=l.transform(new Communicator.Point3(s.x+r.x,s.y+r.y,s.z+r.z)),f=Communicator.Point3.subtract(d,u).normalize();return await n._rotateNodeOffaxis(e,t,o,u,f,i)}static async _rotateNodeOffaxis(e,t,n,r,o,a){var i=e.model.getNodeMatrix(t),s=new Communicator.Matrix,c=new Communicator.Matrix;(c=new Communicator.Matrix).setTranslationComponent(-r.x,-r.y,-r.z);var l=new Communicator.Matrix;l.setTranslationComponent(r.x,r.y,r.z),Communicator.Util.computeOffaxisRotation(o,n,s);var u=Communicator.Matrix.multiply(c,s),d=Communicator.Matrix.multiply(u,l);let f=Communicator.Matrix.multiply(d,i);return a&&await e.model.setNodeMatrix(t,f),f}static async _createBoundingMesh(e,t,n){var r=new Communicator.MeshData,o=[[t.x,t.y,t.z,n.x,t.y,t.z,n.x,n.y,t.z,t.x,n.y,t.z,t.x,t.y,t.z],[t.x,t.y,n.z,n.x,t.y,n.z,n.x,n.y,n.z,t.x,n.y,n.z,t.x,t.y,n.z],[t.x,t.y,t.z,t.x,t.y,n.z,n.x,t.y,n.z,n.x,n.y,n.z,t.x,n.y,n.z],[n.x,n.y,t.z,n.x,n.y,n.z],[t.x,n.y,t.z,t.x,n.y,n.z],[n.x,t.y,t.z,n.x,t.y,n.z]];for(let e=0;e<o.length;e++)r.addPolyline(o[e]);return await e.model.createMesh(r)}}hcMinimalBounding=t})();